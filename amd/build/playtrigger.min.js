/**
 * Scripts for mod_kalmediares
 *
 * @copyright (C) 2016-2025 Yamaguchi University (gh-cc@mlex.cc.yamaguchi-u.ac.jp)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_kalmediares/playtrigger",["jquery"],(function($){return{init:function(serviceURL,cmid){var videoTags,iframeTags,trigger=!1,listener=!1,checkAction=null;function triggerEvent(){var flag,fd=new FormData;fd.append("id",cmid);var postData={type:"POST",data:fd,cache:!1,contentType:!1,scriptCharset:"utf-8",processData:!1,async:!0,dataType:"xml"};return serviceURL=serviceURL+"?id="+cmid,$.ajax(serviceURL,postData).done((function(xmlData){null===xmlData&&(flag=!1),flag=!0})).fail((function(xmlData){window.console.dir(xmlData),flag=!1})),flag}function setCallback(element){var ua,mobile=!1,os=(ua=navigator.userAgent).match(/iPhone|iPad|iPod|IPHONE|IPAD|IPOD|iphone|ipad|ipod/)?"iOS":ua.match(/Android|android|ANDROID/)?"Android":ua.match(/Linux|linux|LINUX|ubuntu|Ubuntu|UBUNTU/)?"Linux":ua.match(/Win(dows)|WIN(DOWS)/)?"Windows":ua.match(/Mac|PPC/)?"Mac OS":ua.match(/CrOS/)?"Chrome OS":ua.match(/mobile|Mobile|MOBILE/)?"Mobile":"Other";"iOS"!=os&&"Android"!=os&&"Chrome OS"!=os&&"Mobile"!=os||(mobile=!0),null!==element&&element.length>=1&&(element.on("play",(function(){videoTags.off("play","**"),!1===trigger&&(trigger=!0,triggerEvent())})),element.on("playing",(function(){videoTags.off("playing","**"),!1===trigger&&(trigger=!0,triggerEvent())})),!0===mobile&&(element.on("timeupdate",(function(){videoTags.off("timeupdate","**"),!1===trigger&&(trigger=!0,triggerEvent())})),element.on("seeked",(function(){videoTags.off("seeked","**"),!1===trigger&&(trigger=!0,triggerEvent())})),element.on("pause",(function(){videoTags.off("pause","**"),!1===trigger&&(trigger=!0,triggerEvent())})),element.on("ended",(function(){videoTags.off("ended","**"),!1===trigger&&(trigger=!0,triggerEvent())})),element.on("ratechange",(function(){videoTags.off("ratechange","**"),!1===trigger&&(trigger=!0,triggerEvent())}))),listener=!0)}function checkElement(){!1===listener&&!1===trigger&&(null!==(videoTags=$("video"))&&videoTags.length>=1||null!==(iframeTags=$("iframe"))&&iframeTags.length>=1&&null!==(videoTags=iframeTags.eq(0).contents().find("video"))&&videoTags.length>=1)&&setCallback(videoTags),!0===listener&&null!==checkAction&&clearInterval(checkAction)}null!==serviceURL&&""!==serviceURL&&($(document).ready((function(){!1===trigger&&!1===listener&&checkElement(),null===checkAction&&(checkAction=setInterval(checkElement,1e3))})),$("iframe").on("load",(function(){!1===trigger&&!1===listener&&checkElement(),null===checkAction&&(checkAction=setInterval(checkElement,1e3))})),$(window).on("load",(function(){!1===trigger&&!1===listener&&checkElement(),null===checkAction&&(checkAction=setInterval(checkElement,1e3))})),$(window).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",(function(){!1===trigger&&!1===listener&&checkElement(),null===checkAction&&(checkAction=setInterval(checkElement,1e3))})))}}}));

//# sourceMappingURL=playtrigger.min.js.map