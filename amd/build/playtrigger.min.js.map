{"version":3,"sources":["../src/playtrigger.js"],"names":["define","$","init","serviceURL","cmid","videoTags","trigger","getOperatingSystem","os","ua","navigator","userAgent","match","triggerEvent","fd","FormData","flag","append","ajax","type","data","cache","contentType","scriptCharset","processData","async","dataType","done","xmlData","fail","window","console","dir","arisePlay","off","arisePlaying","ariseTimeupdate","ariseSeeked","arisePause","ariseEnded","ariseRatechange","mobile","on","length","eq","contents","find"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Scripts for mod_kalmediares\n *\n * @package    mod_kalmediares\n * @copyright  (C) 2016-2020 Yamaguchi University (gh-cc@mlex.cc.yamaguchi-u.ac.jp)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_kalmediares/playtrigger\n */\n\ndefine(['jquery'], function($) {\n\n    return {\n        /**\n         * Initial function.\n         * @access public\n         * @param {string} serviceURL - url of event record page.\n         * @param {string} cmid - id of content module.\n         */\n        init: function(serviceURL, cmid) {\n\n            var videoTags;\n            var trigger = false;\n\n            /**\n             * This function retrieve os type.\n             * @return {string} - os type.\n             */\n            function getOperatingSystem() {\n                var os;\n                var ua = navigator.userAgent;\n\n                if (ua.match(/iPhone|iPad|iPod/)) {\n                    os = \"iOS\";\n                } else if (ua.match(/Android|android/)) {\n                    os = \"Android\";\n                } else if (ua.match(/Linux|linux/)) {\n                    os = \"Linux\";\n                } else if (ua.match(/Win(dows)/)) {\n                    os = \"Windows\";\n                } else if (ua.match(/Mac|PPC/)) {\n                    os = \"Mac OS\";\n                } else if (ua.match(/CrOS/)) {\n                    os = \"Chrome OS\";\n                } else {\n                    os = \"Other\";\n                }\n\n                return os;\n            }\n\n            /**\n             * This function trigger event.\n             * @return {bool} - true if event transmission was succeed. Otherwise false.\n             */\n            function triggerEvent() {\n                var fd = new FormData();\n                var flag;\n\n                fd.append('id', cmid);\n\n                // Create tnrasmission data.\n                var postData = {\n                    type: 'POST',\n                    data: fd,\n                    cache: false,\n                    contentType: false,\n                    scriptCharset: 'utf-8',\n                    processData: false,\n                    async: true,\n                    dataType: 'xml'\n                };\n\n                serviceURL = serviceURL + '?id=' + cmid;\n\n                // Transmit data.\n                $.ajax(\n                   serviceURL, postData\n                )\n                .done(function(xmlData) {\n                    // Response is not XML.\n                    if (xmlData === null) {\n                        flag = false;\n                    }\n\n                    flag = true;\n                })\n                .fail(function(xmlData) {\n                    window.console.dir(xmlData);\n                    flag = false;\n                });\n\n                return flag;\n            }\n\n            /**\n             * This function arise play event.\n             */\n            function arisePlay() {\n                videoTags.off(\"play\", \"**\");\n                if (trigger === false) {\n                    trigger = true;\n                    triggerEvent();\n                }\n            }\n\n            /**\n             * This function arise playing event.\n             */\n            function arisePlaying() {\n                videoTags.off(\"playing\", \"**\");\n                if (trigger === false) {\n                    trigger = true;\n                    triggerEvent();\n                }\n            }\n\n            /**\n             * This function arise timeupdate event.\n             */\n            function ariseTimeupdate() {\n                videoTags.off(\"timeupdate\", \"**\");\n                if (trigger === false) {\n                    trigger = true;\n                    triggerEvent();\n                }\n            }\n\n            /**\n             * This function arise seeked event.\n             */\n            function ariseSeeked() {\n                videoTags.off(\"seeked\", \"**\");\n                if (trigger === false) {\n                    trigger = true;\n                    triggerEvent();\n                }\n            }\n\n            /**\n             * This function arise pause event.\n             */\n            function arisePause() {\n                videoTags.off(\"pause\", \"**\");\n                if (trigger === false) {\n                    trigger = true;\n                    triggerEvent();\n                }\n            }\n\n            /**\n             * This function arise ended event.\n             */\n            function ariseEnded() {\n                videoTags.off(\"ended\", \"**\");\n                if (trigger === false) {\n                    trigger = true;\n                    triggerEvent();\n                }\n            }\n\n            /**\n             * This function arise ratechange event.\n             */\n            function ariseRatechange() {\n                videoTags.off(\"ratechange\", \"**\");\n                if (trigger === false) {\n                    trigger = true;\n                    triggerEvent();\n                }\n            }\n\n            if (serviceURL !== null && serviceURL !== \"\") {\n                var mobile = false;\n                var os = getOperatingSystem();\n\n                if (os == 'iOS' || os == 'Android' || os == 'Chrome OS') {\n                    mobile = true;\n                }\n\n                $(window).on(\"load\", function() {\n                    videoTags = $(\"video\");\n                    if (videoTags !== null && videoTags.length >= 1) {\n                        videoTags.on(\"play\", function() {\n                            arisePlay();\n                        });\n                        videoTags.on(\"playing\", function() {\n                            arisePlaying();\n                        });\n\n                        if (mobile === true) {\n                            videoTags.on(\"timeupdate\", function() {\n                                ariseTimeupdate();\n                            });\n                            videoTags.on(\"seeked\", function() {\n                                ariseSeeked();\n                            });\n                            videoTags.on(\"pause\", function() {\n                                arisePause();\n                            });\n                            videoTags.on(\"ended\", function() {\n                                ariseEnded();\n                            });\n                            videoTags.on(\"ratechange\", function() {\n                                ariseRatechange();\n                            });\n                        }\n                    }\n                });\n\n                $(\"iframe\").on(\"load\", function() {\n                    videoTags = $(\"iframe\").eq(0).contents().find(\"video\");\n                    if (videoTags !== null && videoTags.length >= 1) {\n                        videoTags.on(\"play\", function() {\n                            arisePlay();\n                        });\n                        videoTags.on(\"playing\", function() {\n                            arisePlaying();\n                        });\n                        if (mobile === true) {\n                            videoTags.on(\"timeupdate\", function() {\n                                ariseTimeupdate();\n                            });\n                            videoTags.on(\"seeked\", function() {\n                                ariseSeeked();\n                            });\n                            videoTags.on(\"pause\", function() {\n                                arisePause();\n                            });\n                            videoTags.on(\"ended\", function() {\n                                ariseEnded();\n                            });\n                            videoTags.on(\"ratechange\", function() {\n                                ariseRatechange();\n                            });\n                        }\n                    }\n                });\n            }\n        }\n    };\n});\n"],"file":"playtrigger.min.js"}